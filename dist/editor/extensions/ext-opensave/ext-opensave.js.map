{"version":3,"file":"ext-opensave.js","sources":["../../../../node_modules/browser-fs-access/dist/esm/index.js","../../../../src/editor/extensions/ext-opensave/ext-opensave.js","../../../../src/editor/extensions/ext-opensave/locale/en.js","../../../../src/editor/extensions/ext-opensave/locale/fr.js","../../../../src/editor/extensions/ext-opensave/locale/zh-CN.js"],"sourcesContent":["var T=Object.defineProperty;var f=(e,t)=>()=>(e&&(t=e(e=0)),t);var d=(e,t)=>{for(var i in t)T(e,i,{get:t[i],enumerable:!0})};var y={};d(y,{default:()=>E});var E,p=f(()=>{E=async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise((t,i)=>{let r=document.createElement(\"input\");r.type=\"file\";let l=[...e.map(s=>s.mimeTypes||[]).join(),e.map(s=>s.extensions||[]).join()].join();r.multiple=e[0].multiple||!1,r.accept=l||\"\";let n=()=>c(i),a=s=>{typeof c==\"function\"&&c(),t(s)},c=e[0].legacySetup&&e[0].legacySetup(a,n,r);r.addEventListener(\"change\",()=>{a(r.multiple?Array.from(r.files):r.files[0])}),r.click()}))});var w={};d(w,{default:()=>I});var N,I,h=f(()=>{N=async e=>{let t=await e.getFile();return t.handle=e,t},I=async(e=[{}])=>{Array.isArray(e)||(e=[e]);let t=[];e.forEach((l,n)=>{t[n]={description:l.description||\"\",accept:{}},l.mimeTypes?l.mimeTypes.map(a=>{t[n].accept[a]=l.extensions||[]}):t[n].accept[\"*/*\"]=l.extensions||[]});let i=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),r=await Promise.all(i.map(N));return e[0].multiple?r:r[0]}});var o={};d(o,{default:()=>M});var M,A=f(()=>{M=async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise((t,i)=>{let r=document.createElement(\"input\");r.type=\"file\",r.webkitdirectory=!0;let l=()=>a(i),n=c=>{typeof a==\"function\"&&a(),t(c)},a=e[0].legacySetup&&e[0].legacySetup(n,l,r);r.addEventListener(\"change\",()=>{let c=Array.from(r.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(c=c.filter(s=>s.webkitRelativePath.split(\"/\").every(S=>!e[0].skipDirectory({name:S,kind:\"directory\"})))):c=c.filter(s=>s.webkitRelativePath.split(\"/\").length===2),n(c)}),r.click()}))});var x={};d(x,{default:()=>B});var v,B,g=f(()=>{v=async(e,t,i=e.name,r)=>{let l=[],n=[];for await(let a of e.values()){let c=`${i}/${a.name}`;a.kind===\"file\"?n.push(a.getFile().then(s=>(s.directoryHandle=e,s.handle=a,Object.defineProperty(s,\"webkitRelativePath\",{configurable:!0,enumerable:!0,get:()=>c})))):a.kind===\"directory\"&&t&&(!r||!r(a))&&l.push(v(a,t,c,r))}return[...(await Promise.all(l)).flat(),...await Promise.all(n)]},B=async(e={})=>{e.recursive=e.recursive||!1;let t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn});return v(t,e.recursive,void 0,e.skipDirectory)}});var k={};d(k,{default:()=>W});async function $(e,t){let i=e.getReader(),r=new ReadableStream({start(n){return a();async function a(){return i.read().then(({done:c,value:s})=>{if(c){n.close();return}return n.enqueue(s),a()})}}}),l=new Response(r);return i.releaseLock(),new Blob([await l.blob()],{type:t})}var W,P=f(()=>{W=async(e,t={})=>{Array.isArray(t)&&(t=t[0]);let i=document.createElement(\"a\"),r=e;\"body\"in e&&(r=await $(e.body,e.headers.get(\"content-type\"))),i.download=t.fileName||\"Untitled\",i.href=URL.createObjectURL(r);let l=()=>a(reject),n=()=>{typeof a==\"function\"&&a()},a=t.legacySetup&&t.legacySetup(n,l,i);return i.addEventListener(\"click\",()=>{setTimeout(()=>URL.revokeObjectURL(i.href),30*1e3),n(null)}),i.click(),null}});var j={};d(j,{default:()=>q});var q,L=f(()=>{q=async(e,t=[{}],i=null,r=!1)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||\"Untitled\";let l=[];if(t.forEach((c,s)=>{l[s]={description:c.description||\"\",accept:{}},c.mimeTypes?(s===0&&(e.type?c.mimeTypes.push(e.type):e.headers&&e.headers.get(\"content-type\")&&c.mimeTypes.push(e.headers.get(\"content-type\"))),c.mimeTypes.map(m=>{l[s].accept[m]=c.extensions||[]})):e.type&&(l[s].accept[e.type]=c.extensions||[])}),i)try{await i.getFile()}catch(c){if(i=null,r)throw c}let n=i||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:l,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1}),a=await n.createWritable();return\"stream\"in e?(await e.stream().pipeTo(a),n):\"body\"in e?(await e.body.pipeTo(a),n):(await a.write(blob),await a.close(),n)}});var F=(()=>{if(typeof self==\"undefined\")return!1;if(\"top\"in self&&self!==top)try{top.location+\"\"}catch{return!1}else if(\"showOpenFilePicker\"in self)return\"showOpenFilePicker\";return!1})(),u=F;var U=u?Promise.resolve().then(()=>(h(),w)):Promise.resolve().then(()=>(p(),y));async function _(...e){return(await U).default(...e)}var D=u?Promise.resolve().then(()=>(g(),x)):Promise.resolve().then(()=>(A(),o));async function O(...e){return(await D).default(...e)}var z=u?Promise.resolve().then(()=>(L(),j)):Promise.resolve().then(()=>(P(),k));async function C(...e){return(await z).default(...e)}export{O as directoryOpen,_ as fileOpen,C as fileSave,u as supported};\n// @license © 2020 Google LLC. Licensed under the Apache License, Version 2.0.\n","/* globals seConfirm */\r\n/**\r\n * @file ext-opensave.js\r\n *\r\n * @license MIT\r\n *\r\n * @copyright 2020 OptimistikSAS\r\n *\r\n */\r\n\r\n/**\r\n   * @type {module:svgcanvas.EventHandler}\r\n   * @param {external:Window} wind\r\n   * @param {module:svgcanvas.SvgCanvas#event:saved} svg The SVG source\r\n   * @listens module:svgcanvas.SvgCanvas#event:saved\r\n   * @returns {void}\r\n   */\r\nimport { fileOpen, fileSave } from 'browser-fs-access'\r\n\r\nconst name = 'opensave'\r\nlet handle = null\r\n\r\nconst loadExtensionTranslation = async function (svgEditor) {\r\n  let translationModule\r\n  const lang = svgEditor.configObj.pref('lang')\r\n  try {\r\n    translationModule = await import(`./locale/${lang}.js`)\r\n  } catch (_error) {\r\n    console.warn(`Missing translation (${lang}) for ${name} - using 'en'`)\r\n    translationModule = await import('./locale/en.js')\r\n  }\r\n  svgEditor.i18next.addResourceBundle(lang, 'translation', translationModule.default, true, true)\r\n}\r\n\r\nexport default {\r\n  name,\r\n  async init (_S) {\r\n    const svgEditor = this\r\n    const { svgCanvas } = svgEditor\r\n    const { $id, $click } = svgCanvas\r\n    await loadExtensionTranslation(svgEditor)\r\n    /**\r\n    * @param {Event} e\r\n    * @returns {void}\r\n    */\r\n    const importImage = (e) => {\r\n      $id('se-prompt-dialog').title = this.i18next.t('notification.loadingImage')\r\n      $id('se-prompt-dialog').setAttribute('close', false)\r\n      e.stopPropagation()\r\n      e.preventDefault()\r\n      const file = (e.type === 'drop') ? e.dataTransfer.files[0] : e.currentTarget.files[0]\r\n      if (!file) {\r\n        $id('se-prompt-dialog').setAttribute('close', true)\r\n        return\r\n      }\r\n\r\n      if (!file.type.includes('image')) {\r\n        return\r\n      }\r\n      // Detected an image\r\n      // svg handling\r\n      let reader\r\n      if (file.type.includes('svg')) {\r\n        reader = new FileReader()\r\n        reader.onloadend = (ev) => {\r\n          const newElement = this.svgCanvas.importSvgString(ev.target.result, true)\r\n          this.svgCanvas.alignSelectedElements('m', 'page')\r\n          this.svgCanvas.alignSelectedElements('c', 'page')\r\n          // highlight imported element, otherwise we get strange empty selectbox\r\n          this.svgCanvas.selectOnly([newElement])\r\n          $id('se-prompt-dialog').setAttribute('close', true)\r\n        }\r\n        reader.readAsText(file)\r\n      } else {\r\n        // bitmap handling\r\n        reader = new FileReader()\r\n        reader.onloadend = function ({ target: { result } }) {\r\n          /**\r\n              * Insert the new image until we know its dimensions.\r\n              * @param {Float} imageWidth\r\n              * @param {Float} imageHeight\r\n              * @returns {void}\r\n              */\r\n          const insertNewImage = (imageWidth, imageHeight) => {\r\n            const newImage = this.svgCanvas.addSVGElementsFromJson({\r\n              element: 'image',\r\n              attr: {\r\n                x: 0,\r\n                y: 0,\r\n                width: imageWidth,\r\n                height: imageHeight,\r\n                id: this.svgCanvas.getNextId(),\r\n                style: 'pointer-events:inherit'\r\n              }\r\n            })\r\n            this.svgCanvas.setHref(newImage, result)\r\n            this.svgCanvas.selectOnly([newImage])\r\n            this.svgCanvas.alignSelectedElements('m', 'page')\r\n            this.svgCanvas.alignSelectedElements('c', 'page')\r\n            this.topPanel.updateContextPanel()\r\n            $id('se-prompt-dialog').setAttribute('close', true)\r\n          }\r\n          // create dummy img so we know the default dimensions\r\n          let imgWidth = 100\r\n          let imgHeight = 100\r\n          const img = new Image()\r\n          img.style.opacity = 0\r\n          img.addEventListener('load', () => {\r\n            imgWidth = img.offsetWidth || img.naturalWidth || img.width\r\n            imgHeight = img.offsetHeight || img.naturalHeight || img.height\r\n            insertNewImage(imgWidth, imgHeight)\r\n          })\r\n          img.src = result\r\n        }\r\n        reader.readAsDataURL(file)\r\n      }\r\n    }\r\n    // create an input with type file to open the filesystem dialog\r\n    const imgImport = document.createElement('input')\r\n    imgImport.type = 'file'\r\n    imgImport.addEventListener('change', importImage)\r\n    // dropping a svg file will import it in the svg as well\r\n    this.workarea.addEventListener('drop', importImage)\r\n    /**\r\n     * @fires module:svgcanvas.SvgCanvas#event:ext_onNewDocument\r\n     * @returns {void}\r\n     */\r\n    const clickClear = async function () {\r\n      const [x, y] = svgEditor.configObj.curConfig.dimensions\r\n      const ok = await seConfirm(svgEditor.i18next.t('notification.QwantToClear'))\r\n      if (ok === 'Cancel') {\r\n        return\r\n      }\r\n      svgEditor.leftPanel.clickSelect()\r\n      svgEditor.svgCanvas.clear()\r\n      svgEditor.svgCanvas.setResolution(x, y)\r\n      svgEditor.updateCanvas(true)\r\n      svgEditor.zoomImage()\r\n      svgEditor.layersPanel.populateLayers()\r\n      svgEditor.topPanel.updateContextPanel()\r\n      svgEditor.topPanel.updateTitle('untitled.svg')\r\n      svgEditor.svgCanvas.runExtensions('onNewDocument')\r\n    }\r\n\r\n    /**\r\n     * By default,  this.editor.svgCanvas.open() is a no-op. It is up to an extension\r\n     *  mechanism (opera widget, etc.) to call `setCustomHandlers()` which\r\n     *  will make it do something.\r\n     * @returns {void}\r\n     */\r\n    const clickOpen = async function () {\r\n      // ask user before clearing an unsaved SVG\r\n      const response = await svgEditor.openPrep()\r\n      if (response === 'Cancel') { return }\r\n      svgCanvas.clear()\r\n      try {\r\n        const blob = await fileOpen({\r\n          mimeTypes: ['image/*']\r\n        })\r\n        const svgContent = await blob.text()\r\n        await svgEditor.loadSvgString(svgContent)\r\n        svgEditor.updateCanvas()\r\n        handle = blob.handle\r\n        svgEditor.topPanel.updateTitle(blob.name)\r\n        svgEditor.svgCanvas.runExtensions('onOpenedDocument', {\r\n          name: blob.name,\r\n          lastModified: blob.lastModified,\r\n          size: blob.size,\r\n          type: blob.type\r\n        })\r\n      } catch (err) {\r\n        if (err.name !== 'AbortError') {\r\n          return console.error(err)\r\n        }\r\n      }\r\n    }\r\n    const b64toBlob = (b64Data, contentType = '', sliceSize = 512) => {\r\n      const byteCharacters = atob(b64Data)\r\n      const byteArrays = []\r\n      for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n        const slice = byteCharacters.slice(offset, offset + sliceSize)\r\n        const byteNumbers = new Array(slice.length)\r\n        for (let i = 0; i < slice.length; i++) {\r\n          byteNumbers[i] = slice.charCodeAt(i)\r\n        }\r\n        const byteArray = new Uint8Array(byteNumbers)\r\n        byteArrays.push(byteArray)\r\n      }\r\n      const blob = new Blob(byteArrays, { type: contentType })\r\n      return blob\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns {void}\r\n     */\r\n    const clickSave = async function (type) {\r\n      const $editorDialog = $id('se-svg-editor-dialog')\r\n      const editingsource = $editorDialog.getAttribute('dialog') === 'open'\r\n      if (editingsource) {\r\n        svgEditor.saveSourceEditor()\r\n      } else {\r\n        // In the future, more options can be provided here\r\n        const saveOpts = {\r\n          images: svgEditor.configObj.pref('img_save'),\r\n          round_digits: 6\r\n        }\r\n        // remove the selected outline before serializing\r\n        svgCanvas.clearSelection()\r\n        // Update save options if provided\r\n        if (saveOpts) {\r\n          const saveOptions = svgCanvas.mergeDeep(svgCanvas.getSvgOption(), saveOpts)\r\n          for (const [key, value] of Object.entries(saveOptions)) {\r\n            svgCanvas.setSvgOption(key, value)\r\n          }\r\n        }\r\n        svgCanvas.setSvgOption('apply', true)\r\n\r\n        // no need for doctype, see https://jwatt.org/svg/authoring/#doctype-declaration\r\n        const svg = '<?xml version=\"1.0\"?>\\n' + svgCanvas.svgCanvasToString()\r\n        const b64Data = svgCanvas.encode64(svg)\r\n        const blob = b64toBlob(b64Data, 'image/svg+xml')\r\n        try {\r\n          if (type === 'save' && handle !== null) {\r\n            const throwIfExistingHandleNotGood = false\r\n            handle = await fileSave(blob, {\r\n              fileName: 'untitled.svg',\r\n              extensions: ['.svg']\r\n            }, handle, throwIfExistingHandleNotGood)\r\n          } else {\r\n            handle = await fileSave(blob, {\r\n              fileName: svgEditor.title,\r\n              extensions: ['.svg']\r\n            })\r\n          }\r\n          svgEditor.topPanel.updateTitle(handle.name)\r\n          svgCanvas.runExtensions('onSavedDocument', {\r\n            name: handle.name,\r\n            kind: handle.kind\r\n          })\r\n        } catch (err) {\r\n          if (err.name !== 'AbortError') {\r\n            return console.error(err)\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      name: svgEditor.i18next.t(`${name}:name`),\r\n      // The callback should be used to load the DOM with the appropriate UI items\r\n      callback () {\r\n        const buttonTemplate = `\r\n        <se-menu-item id=\"tool_clear\" label=\"opensave.new_doc\" shortcut=\"N\" src=\"new.svg\"></se-menu-item>`\r\n        svgCanvas.insertChildAtIndex($id('main_button'), buttonTemplate, 0)\r\n        const openButtonTemplate = '<se-menu-item id=\"tool_open\" label=\"opensave.open_image_doc\" src=\"open.svg\"></se-menu-item>'\r\n        svgCanvas.insertChildAtIndex($id('main_button'), openButtonTemplate, 1)\r\n        const saveButtonTemplate = '<se-menu-item id=\"tool_save\" label=\"opensave.save_doc\" shortcut=\"S\" src=\"saveImg.svg\"></se-menu-item>'\r\n        svgCanvas.insertChildAtIndex($id('main_button'), saveButtonTemplate, 2)\r\n        const saveAsButtonTemplate = '<se-menu-item id=\"tool_save_as\" label=\"opensave.save_as_doc\" src=\"saveImg.svg\"></se-menu-item>'\r\n        svgCanvas.insertChildAtIndex($id('main_button'), saveAsButtonTemplate, 3)\r\n        const importButtonTemplate = '<se-menu-item id=\"tool_import\" label=\"tools.import_doc\" src=\"importImg.svg\"></se-menu-item>'\r\n        svgCanvas.insertChildAtIndex($id('main_button'), importButtonTemplate, 4)\r\n\r\n        // handler\r\n        $click($id('tool_clear'), clickClear.bind(this))\r\n        $click($id('tool_open'), clickOpen.bind(this))\r\n        $click($id('tool_save'), clickSave.bind(this, 'save'))\r\n        $click($id('tool_save_as'), clickSave.bind(this, 'saveas'))\r\n        $click($id('tool_import'), () => imgImport.click())\r\n      }\r\n    }\r\n  }\r\n}\r\n","export default {\r\n  opensave: {\r\n    new_doc: 'New Image',\r\n    open_image_doc: 'Open SVG',\r\n    save_doc: 'Save SVG',\r\n    save_as_doc: 'Save as SVG'\r\n  }\r\n}\r\n","export default {\r\n  opensave: {\r\n    new_doc: 'Nouvelle image',\r\n    open_image_doc: 'Ouvrir le SVG',\r\n    save_doc: 'Enregistrer l\\'image',\r\n    save_as_doc: 'Enregistrer en tant qu\\'image'\r\n  }\r\n}\r\n","export default {\r\n  opensave: {\r\n    new_doc: '新图片',\r\n    open_image_doc: '打开 SVG',\r\n    save_doc: '保存图像',\r\n    save_as_doc: '另存为图像'\r\n  }\r\n}\r\n"],"names":["T","Object","defineProperty","f","e","t","d","i","get","enumerable","y","default","E","p","async","Array","isArray","Promise","r","document","createElement","type","l","map","s","mimeTypes","join","extensions","multiple","accept","a","c","legacySetup","addEventListener","from","files","click","w","I","N","h","getFile","handle","forEach","n","description","window","showOpenFilePicker","id","startIn","types","excludeAcceptAllOption","all","o","M","A","recursive","webkitdirectory","skipDirectory","filter","webkitRelativePath","split","every","S","name","kind","length","x","B","v","g","values","push","then","directoryHandle","configurable","flat","showDirectoryPicker","k","$","getReader","ReadableStream","start","read","_ref","done","value","enqueue","close","Response","releaseLock","Blob","blob","W","P","body","headers","download","fileName","href","URL","createObjectURL","reject","setTimeout","revokeObjectURL","j","q","L","m","showSaveFilePicker","suggestedName","createWritable","stream","pipeTo","write","u","self","top","location","U","resolve","z","C","loadExtensionTranslation","svgEditor","translationModule","lang","configObj","pref","__variableDynamicImportRuntime0__","_error","console","warn","i18next","addResourceBundle","_S","this","svgCanvas","$id","$click","importImage","title","setAttribute","stopPropagation","preventDefault","file","dataTransfer","currentTarget","includes","reader","FileReader","onloadend","ev","newElement","importSvgString","target","result","alignSelectedElements","selectOnly","readAsText","insertNewImage","imageWidth","imageHeight","newImage","addSVGElementsFromJson","element","attr","width","height","getNextId","style","setHref","topPanel","updateContextPanel","imgWidth","imgHeight","img","Image","opacity","offsetWidth","naturalWidth","offsetHeight","naturalHeight","src","readAsDataURL","imgImport","workarea","clickClear","curConfig","dimensions","seConfirm","leftPanel","clickSelect","clear","setResolution","updateCanvas","zoomImage","layersPanel","populateLayers","updateTitle","runExtensions","clickOpen","openPrep","_","fileOpen","svgContent","text","loadSvgString","lastModified","size","err","error","clickSave","getAttribute","saveSourceEditor","saveOpts","images","round_digits","clearSelection","saveOptions","mergeDeep","getSvgOption","key","entries","setSvgOption","svg","svgCanvasToString","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","slice","byteNumbers","charCodeAt","byteArray","Uint8Array","b64toBlob","encode64","throwIfExistingHandleNotGood","fileSave","callback","insertChildAtIndex","bind","opensave","new_doc","open_image_doc","save_doc","save_as_doc"],"mappings":"AAAA,IAAIA,EAAEC,OAAOC,eAAmBC,EAAE,CAACC,EAAEC,IAAI,KAAKD,IAAIC,EAAED,EAAEA,EAAE,IAAIC,GAAOC,EAAE,CAACF,EAAEC,SAAS,IAAIE,KAAKF,EAAEL,EAAEI,EAAEG,EAAE,CAACC,IAAIH,EAAEE,GAAGE,YAAW,KAAUC,EAAE,GAAGJ,EAAEI,EAAE,CAACC,QAAQ,IAAIC,IAAI,IAAIA,EAAEC,EAAEV,GAAE,KAAKS,EAAEE,qBAAMV,yDAAE,CAAC,WAAOW,MAAMC,QAAQZ,KAAKA,EAAE,CAACA,IAAI,IAAIa,SAAQ,CAACZ,EAAEE,SAASW,EAAEC,SAASC,cAAc,SAASF,EAAEG,KAAK,WAAWC,EAAE,IAAIlB,EAAEmB,KAAIC,GAAGA,EAAEC,WAAW,KAAIC,OAAOtB,EAAEmB,KAAIC,GAAGA,EAAEG,YAAY,KAAID,QAAQA,OAAOR,EAAEU,SAASxB,EAAE,GAAGwB,WAAU,EAAGV,EAAEW,OAAOP,GAAG,OAAkBQ,EAAEN,IAAc,mBAAHO,GAAeA,IAAI1B,EAAEmB,IAAIO,EAAE3B,EAAE,GAAG4B,aAAa5B,EAAE,GAAG4B,YAAYF,GAApF,IAAIC,EAAExB,IAAkFW,GAAGA,EAAEe,iBAAiB,UAAS,KAAKH,EAAEZ,EAAEU,SAASb,MAAMmB,KAAKhB,EAAEiB,OAAOjB,EAAEiB,MAAM,OAAMjB,EAAEkB,eAAiBC,EAAE,GAAG/B,EAAE+B,EAAE,CAAC1B,QAAQ,IAAI2B,IAAI,IAAIC,EAAED,EAAEE,EAAErC,GAAE,KAAKoC,EAAEzB,MAAAA,QAAcT,QAAQD,EAAEqC,iBAAiBpC,EAAEqC,OAAOtC,EAAEC,GAAGiC,EAAExB,qBAAMV,yDAAE,CAAC,IAAOW,MAAMC,QAAQZ,KAAKA,EAAE,CAACA,QAAQC,EAAE,GAAGD,EAAEuC,SAAQ,CAACrB,EAAEsB,KAAKvC,EAAEuC,GAAG,CAACC,YAAYvB,EAAEuB,aAAa,GAAGhB,OAAO,IAAIP,EAAEG,UAAUH,EAAEG,UAAUF,KAAIO,IAAIzB,EAAEuC,GAAGf,OAAOC,GAAGR,EAAEK,YAAY,MAAKtB,EAAEuC,GAAGf,OAAO,OAAOP,EAAEK,YAAY,UAASpB,QAAQuC,OAAOC,mBAAmB,CAACC,GAAG5C,EAAE,GAAG4C,GAAGC,QAAQ7C,EAAE,GAAG6C,QAAQC,MAAM7C,EAAEuB,SAASxB,EAAE,GAAGwB,WAAU,EAAGuB,uBAAuB/C,EAAE,GAAG+C,yBAAwB,IAAKjC,QAAQD,QAAQmC,IAAI7C,EAAEgB,IAAIgB,WAAWnC,EAAE,GAAGwB,SAASV,EAAEA,EAAE,OAAUmC,EAAE,GAAG/C,EAAE+C,EAAE,CAAC1C,QAAQ,IAAI2C,IAAI,IAAIA,EAAEC,EAAEpD,GAAE,KAAKmD,EAAExC,qBAAMV,yDAAE,CAAC,WAAOW,MAAMC,QAAQZ,KAAKA,EAAE,CAACA,IAAIA,EAAE,GAAGoD,UAAUpD,EAAE,GAAGoD,YAAW,EAAG,IAAIvC,SAAQ,CAACZ,EAAEE,SAASW,EAAEC,SAASC,cAAc,SAASF,EAAEG,KAAK,OAAOH,EAAEuC,iBAAgB,MAAkBb,EAAEb,IAAc,mBAAHD,GAAeA,IAAIzB,EAAE0B,IAAID,EAAE1B,EAAE,GAAG4B,aAAa5B,EAAE,GAAG4B,YAAYY,GAApF,IAAId,EAAEvB,IAAkFW,GAAGA,EAAEe,iBAAiB,UAAS,SAASF,EAAEhB,MAAMmB,KAAKhB,EAAEiB,OAAO/B,EAAE,GAAGoD,UAAUpD,EAAE,GAAGoD,WAAWpD,EAAE,GAAGsD,gBAAgB3B,EAAEA,EAAE4B,QAAOnC,GAAGA,EAAEoC,mBAAmBC,MAAM,KAAKC,OAAMC,IAAI3D,EAAE,GAAGsD,cAAc,CAACM,KAAKD,EAAEE,KAAK,mBAAiBlC,EAAEA,EAAE4B,QAAOnC,GAA4C,IAAzCA,EAAEoC,mBAAmBC,MAAM,KAAKK,SAAYtB,EAAEb,MAAKb,EAAEkB,eAAiB+B,EAAE,GAAG7D,EAAE6D,EAAE,CAACxD,QAAQ,IAAIyD,IAAI,IAAIC,EAAED,EAAEE,EAAEnE,GAAE,KAAKkE,EAAEvD,eAAMV,EAAEC,OAAEE,yDAAEH,EAAE4D,KAAK9C,yCAASI,EAAE,GAAGsB,EAAE,aAAa,IAAId,KAAK1B,EAAEmE,SAAS,KAAKxC,YAAKxB,cAAKuB,EAAEkC,MAAgB,SAATlC,EAAEmC,KAAcrB,EAAE4B,KAAK1C,EAAEW,UAAUgC,MAAKjD,IAAIA,EAAEkD,gBAAgBtE,EAAEoB,EAAEkB,OAAOZ,EAAE7B,OAAOC,eAAesB,EAAE,qBAAqB,CAACmD,cAAa,EAAGlE,YAAW,EAAGD,IAAI,IAAIuB,QAAgB,cAATD,EAAEmC,MAAoB5D,KAAKa,IAAIA,EAAEY,KAAKR,EAAEkD,KAAKH,EAAEvC,EAAEzB,EAAE0B,EAAEb,UAAU,WAAWD,QAAQmC,IAAI9B,IAAIsD,gBAAgB3D,QAAQmC,IAAIR,KAAKwB,EAAEtD,qBAAMV,yDAAE,GAAMA,EAAEoD,UAAUpD,EAAEoD,YAAW,MAAOnD,QAAQyC,OAAO+B,oBAAoB,CAAC7B,GAAG5C,EAAE4C,GAAGC,QAAQ7C,EAAE6C,iBAAiBoB,EAAEhE,EAAED,EAAEoD,eAAU,EAAOpD,EAAEsD,mBAAsBoB,EAAE,GAAwBhE,eAAeiE,EAAE3E,EAAEC,OAAOE,EAAEH,EAAE4E,YAAY9D,EAAE,IAAI+D,eAAe,CAACC,MAAMtC,kBAA6Bd,WAAWvB,EAAE4E,OAAOV,MAAKW,QAAEC,KAAKtD,EAAEuD,MAAM9D,SAASO,SAA2Ba,EAAE2C,QAAQ/D,GAAGM,IAArCc,EAAE4C,WAAzE1D,KAAsHR,EAAE,IAAImE,SAASvE,UAAUX,EAAEmF,cAAc,IAAIC,KAAK,OAAOrE,EAAEsE,QAAQ,CAACvE,KAAKhB,IAApSC,EAAEwE,EAAE,CAACnE,QAAQ,IAAIkF,IAAuR,IAAIA,EAAEC,EAAE3F,GAAE,KAAK0F,EAAE/E,eAAMV,OAAEC,yDAAE,GAAMU,MAAMC,QAAQX,KAAKA,EAAEA,EAAE,QAAQE,EAAEY,SAASC,cAAc,KAAKF,EAAEd,WAAWA,IAAIc,QAAQ6D,EAAE3E,EAAE2F,KAAK3F,EAAE4F,QAAQxF,IAAI,kBAAkBD,EAAE0F,SAAS5F,EAAE6F,UAAU,WAAW3F,EAAE4F,KAAKC,IAAIC,gBAAgBnF,OAAOI,EAAE,IAAIQ,EAAEwE,QAAQ1D,EAAE,KAAe,mBAAHd,GAAeA,KAAKA,EAAEzB,EAAE2B,aAAa3B,EAAE2B,YAAYY,EAAEtB,EAAEf,UAAUA,EAAE0B,iBAAiB,SAAQ,KAAKsE,YAAW,IAAIH,IAAII,gBAAgBjG,EAAE4F,OAAM,KAAQvD,OAAUrC,EAAE6B,QAAQ,SAAYqE,EAAE,GAAGnG,EAAEmG,EAAE,CAAC9F,QAAQ,IAAI+F,IAAI,IAAIA,EAAEC,EAAExG,GAAE,KAAKuG,EAAE5F,eAAMV,OAAEC,yDAAE,CAAC,IAAIE,yDAAE,KAAKW,0DAAQH,MAAMC,QAAQX,KAAKA,EAAE,CAACA,IAAIA,EAAE,GAAG6F,SAAS7F,EAAE,GAAG6F,UAAU,eAAe5E,EAAE,MAAMjB,EAAEsC,SAAQ,CAACZ,EAAEP,KAAKF,EAAEE,GAAG,CAACqB,YAAYd,EAAEc,aAAa,GAAGhB,OAAO,IAAIE,EAAEN,WAAe,IAAJD,IAAQpB,EAAEiB,KAAKU,EAAEN,UAAU+C,KAAKpE,EAAEiB,MAAMjB,EAAE4F,SAAS5F,EAAE4F,QAAQxF,IAAI,iBAAiBuB,EAAEN,UAAU+C,KAAKpE,EAAE4F,QAAQxF,IAAI,kBAAkBuB,EAAEN,UAAUF,KAAIqF,IAAItF,EAAEE,GAAGK,OAAO+E,GAAG7E,EAAEJ,YAAY,OAAMvB,EAAEiB,OAAOC,EAAEE,GAAGK,OAAOzB,EAAEiB,MAAMU,EAAEJ,YAAY,OAAMpB,EAAE,UAAUA,EAAEkC,UAAU,MAAMV,MAAMxB,EAAE,KAAKW,EAAE,MAAMa,MAAMa,EAAErC,SAASuC,OAAO+D,mBAAmB,CAACC,cAAczG,EAAE,GAAG6F,SAASlD,GAAG3C,EAAE,GAAG2C,GAAGC,QAAQ5C,EAAE,GAAG4C,QAAQC,MAAM5B,EAAE6B,uBAAuB9C,EAAE,GAAG8C,yBAAwB,IAAKrB,QAAQc,EAAEmE,uBAAuB,WAAW3G,SAASA,EAAE4G,SAASC,OAAOnF,GAAGc,GAAG,SAASxC,SAASA,EAAE2F,KAAKkB,OAAOnF,GAAGc,UAAUd,EAAEoF,MAAMtB,YAAY9D,EAAE0D,QAAQ5C,OAAkMuE,EAAtL,SAAsB,oBAANC,KAAkB,OAAM,KAAM,QAAQA,MAAMA,OAAOC,IAAI,IAAIA,IAAIC,SAAY,aAAY,OAAQ,GAAG,uBAAuBF,KAAK,MAAM,4BAA2B,GAA/K,GAA8LG,EAAEJ,EAAElG,QAAQuG,UAAU/C,MAAK,KAAKjC,IAAIH,KAAIpB,QAAQuG,UAAU/C,MAAK,KAAK5D,IAAIH,KAA+DyG,EAAElG,QAAQuG,UAAU/C,MAAK,KAAKH,IAAIH,KAAIlD,QAAQuG,UAAU/C,MAAK,KAAKlB,IAAIF,KAAyD,IAAIoE,EAAEN,EAAElG,QAAQuG,UAAU/C,MAAK,KAAKkC,IAAIF,KAAIxF,QAAQuG,UAAU/C,MAAK,KAAKqB,IAAIhB,KAAIhE,eAAe4G,iBAAqBD,GAAG9G;8ECmBx6I;MAAMqD,EAAO,WACb,IAAItB,EAAS,KAEb,MAAMiF,yBAA2B7G,eAAgB8G,OAC3CC,QACEC,EAAOF,EAAUG,UAAUC,KAAK,YAEpCH,+cAA0BI,oBAAmBH,UAC7C,MAAOI,GACPC,QAAQC,oCAA6BN,mBAAa9D,oBAClD6D,QAA0B5G,+CAE5B2G,EAAUS,QAAQC,kBAAkBR,EAAM,cAAeD,EAAkBlH,SAAS,GAAM,IAG5F,MAAe,CACbqD,KAAAA,aACYuE,SACJX,EAAYY,MACZC,UAAEA,GAAcb,GAChBc,IAAEA,EAAFC,OAAOA,GAAWF,QAClBd,yBAAyBC,SAKzBgB,YAAexI,IACnBsI,EAAI,oBAAoBG,MAAQL,KAAKH,QAAQhI,EAAE,6BAC/CqI,EAAI,oBAAoBI,aAAa,SAAS,GAC9C1I,EAAE2I,kBACF3I,EAAE4I,uBACIC,EAAmB,SAAX7I,EAAEiB,KAAmBjB,EAAE8I,aAAa/G,MAAM,GAAK/B,EAAE+I,cAAchH,MAAM,OAC9E8G,cACHP,EAAI,oBAAoBI,aAAa,SAAS,OAI3CG,EAAK5H,KAAK+H,SAAS,oBAKpBC,EACAJ,EAAK5H,KAAK+H,SAAS,QACrBC,EAAS,IAAIC,WACbD,EAAOE,UAAaC,UACZC,EAAajB,KAAKC,UAAUiB,gBAAgBF,EAAGG,OAAOC,QAAQ,QAC/DnB,UAAUoB,sBAAsB,IAAK,aACrCpB,UAAUoB,sBAAsB,IAAK,aAErCpB,UAAUqB,WAAW,CAACL,IAC3Bf,EAAI,oBAAoBI,aAAa,SAAS,IAEhDO,EAAOU,WAAWd,KAGlBI,EAAS,IAAIC,WACbD,EAAOE,UAAY,gBAAYI,QAAQC,OAAEA,YAOjCI,eAAiB,CAACC,EAAYC,WAC5BC,EAAW3B,KAAKC,UAAU2B,uBAAuB,CACrDC,QAAS,QACTC,KAAM,CACJnG,EAAG,EACHzD,EAAG,EACH6J,MAAON,EACPO,OAAQN,EACRlH,GAAIwF,KAAKC,UAAUgC,YACnBC,MAAO,iCAGNjC,UAAUkC,QAAQR,EAAUP,QAC5BnB,UAAUqB,WAAW,CAACK,SACtB1B,UAAUoB,sBAAsB,IAAK,aACrCpB,UAAUoB,sBAAsB,IAAK,aACrCe,SAASC,qBACdnC,EAAI,oBAAoBI,aAAa,SAAS,QAG5CgC,EAAW,IACXC,EAAY,UACVC,EAAM,IAAIC,MAChBD,EAAIN,MAAMQ,QAAU,EACpBF,EAAI/I,iBAAiB,QAAQ,KAC3B6I,EAAWE,EAAIG,aAAeH,EAAII,cAAgBJ,EAAIT,MACtDQ,EAAYC,EAAIK,cAAgBL,EAAIM,eAAiBN,EAAIR,OACzDR,eAAec,EAAUC,MAE3BC,EAAIO,IAAM3B,GAEZP,EAAOmC,cAAcvC,KAInBwC,EAAYtK,SAASC,cAAc,SACzCqK,EAAUpK,KAAO,OACjBoK,EAAUxJ,iBAAiB,SAAU2G,kBAEhC8C,SAASzJ,iBAAiB,OAAQ2G,mBAKjC+C,WAAa7K,uBACVqD,EAAGzD,GAAKkH,EAAUG,UAAU6D,UAAUC,WAElC,iBADMC,UAAUlE,EAAUS,QAAQhI,EAAE,gCAI/CuH,EAAUmE,UAAUC,cACpBpE,EAAUa,UAAUwD,QACpBrE,EAAUa,UAAUyD,cAAc/H,EAAGzD,GACrCkH,EAAUuE,cAAa,GACvBvE,EAAUwE,YACVxE,EAAUyE,YAAYC,iBACtB1E,EAAUgD,SAASC,qBACnBjD,EAAUgD,SAAS2B,YAAY,gBAC/B3E,EAAUa,UAAU+D,cAAc,mBAS9BC,UAAY3L,oBAGC,iBADM8G,EAAU8E,YAEjCjE,EAAUwD,kBAEFrG,QD5JymI9E,eAAe6L,iBAAqBpF,GAAG5G,sBC4JnoIiM,CAAS,CAC1BnL,UAAW,CAAC,aAERoL,QAAmBjH,EAAKkH,aACxBlF,EAAUmF,cAAcF,GAC9BjF,EAAUuE,eACVzJ,EAASkD,EAAKlD,OACdkF,EAAUgD,SAAS2B,YAAY3G,EAAK5B,MACpC4D,EAAUa,UAAU+D,cAAc,mBAAoB,CACpDxI,KAAM4B,EAAK5B,KACXgJ,aAAcpH,EAAKoH,aACnBC,KAAMrH,EAAKqH,KACX5L,KAAMuE,EAAKvE,OAEb,MAAO6L,MACU,eAAbA,EAAIlJ,YACCmE,QAAQgF,MAAMD,MAwBrBE,UAAYtM,eAAgBO,MAE+B,SADzCqH,EAAI,wBACU2E,aAAa,UAE/CzF,EAAU0F,uBACL,OAECC,EAAW,CACfC,OAAQ5F,EAAUG,UAAUC,KAAK,YACjCyF,aAAc,MAGhBhF,EAAUiF,iBAENH,EAAU,OACNI,EAAclF,EAAUmF,UAAUnF,EAAUoF,eAAgBN,OAC7D,MAAOO,EAAKxI,KAAUrF,OAAO8N,QAAQJ,GACxClF,EAAUuF,aAAaF,EAAKxI,GAGhCmD,EAAUuF,aAAa,SAAS,SAG1BC,EAAM,0BAA4BxF,EAAUyF,oBAE5CtI,EA7CQ,SAACuI,OAASC,yDAAc,GAAIC,yDAAY,UAClDC,EAAiBC,KAAKJ,GACtBK,EAAa,OACd,IAAIC,EAAS,EAAGA,EAASH,EAAepK,OAAQuK,GAAUJ,EAAW,OAClEK,EAAQJ,EAAeI,MAAMD,EAAQA,EAASJ,GAC9CM,EAAc,IAAI5N,MAAM2N,EAAMxK,YAC/B,IAAI3D,EAAI,EAAGA,EAAImO,EAAMxK,OAAQ3D,IAChCoO,EAAYpO,GAAKmO,EAAME,WAAWrO,SAE9BsO,EAAY,IAAIC,WAAWH,GACjCH,EAAWhK,KAAKqK,UAEL,IAAIlJ,KAAK6I,EAAY,CAAEnN,KAAM+M,IAiC3BW,CADGtG,EAAUuG,SAASf,GACH,wBAEjB,SAAT5M,GAA8B,OAAXqB,EAAiB,OAChCuM,GAA+B,EACrCvM,QAAewM,EAAStJ,EAAM,CAC5BM,SAAU,eACVvE,WAAY,CAAC,SACZe,EAAQuM,QAEXvM,QAAewM,EAAStJ,EAAM,CAC5BM,SAAU0B,EAAUiB,MACpBlH,WAAY,CAAC,UAGjBiG,EAAUgD,SAAS2B,YAAY7J,EAAOsB,MACtCyE,EAAU+D,cAAc,kBAAmB,CACzCxI,KAAMtB,EAAOsB,KACbC,KAAMvB,EAAOuB,OAEf,MAAOiJ,MACU,eAAbA,EAAIlJ,YACCmE,QAAQgF,MAAMD,YAMtB,CACLlJ,KAAM4D,EAAUS,QAAQhI,YAAK2D,YAE7BmL,WAGE1G,EAAU2G,mBAAmB1G,EAAI,6HAAgC,GAEjED,EAAU2G,mBAAmB1G,EAAI,eADN,8FAC0C,GAErED,EAAU2G,mBAAmB1G,EAAI,eADN,wGAC0C,GAErED,EAAU2G,mBAAmB1G,EAAI,eADJ,iGAC0C,GAEvED,EAAU2G,mBAAmB1G,EAAI,eADJ,8FAC0C,GAGvEC,EAAOD,EAAI,cAAeiD,WAAW0D,KAAK7G,OAC1CG,EAAOD,EAAI,aAAc+D,UAAU4C,KAAK7G,OACxCG,EAAOD,EAAI,aAAc0E,UAAUiC,KAAK7G,KAAM,SAC9CG,EAAOD,EAAI,gBAAiB0E,UAAUiC,KAAK7G,KAAM,WACjDG,EAAOD,EAAI,gBAAgB,IAAM+C,EAAUrJ,sDC7QpC,CACbkN,SAAU,CACRC,QAAS,YACTC,eAAgB,WAChBC,SAAU,WACVC,YAAa,0DCLF,CACbJ,SAAU,CACRC,QAAS,iBACTC,eAAgB,gBAChBC,SAAU,sBACVC,YAAa,2ECLF,CACbJ,SAAU,CACRC,QAAS,MACTC,eAAgB,SAChBC,SAAU,OACVC,YAAa"}