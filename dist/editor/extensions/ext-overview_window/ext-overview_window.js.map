{"version":3,"file":"ext-overview_window.js","sources":["../../../../src/editor/extensions/ext-overview_window/dragmove/dragmove.js","../../../../src/editor/extensions/ext-overview_window/ext-overview_window.js"],"sourcesContent":["// https://github.com/knadh/dragmove.js\r\n// Kailash Nadh (c) 2020.\r\n// MIT License.\r\n// can't use npm version as the dragmove is different.\r\n\r\nlet _loaded = false\r\nconst _callbacks = []\r\nconst _isTouch = window.ontouchstart !== undefined\r\n\r\nexport const dragmove = function (target, handler, parent, onStart, onEnd, onDrag) {\r\n  // Register a global event to capture mouse moves (once).\r\n  if (!_loaded) {\r\n    document.addEventListener(_isTouch ? 'touchmove' : 'mousemove', function (e) {\r\n      let c = e\r\n      if (e.touches) {\r\n        c = e.touches[0]\r\n      }\r\n\r\n      // On mouse move, dispatch the coords to all registered callbacks.\r\n      for (let i = 0; i < _callbacks.length; i++) {\r\n        _callbacks[i](c.clientX, c.clientY)\r\n      }\r\n    })\r\n  }\r\n\r\n  _loaded = true\r\n  let isMoving = false; let hasStarted = false\r\n  let startX = 0; let startY = 0; let lastX = 0; let lastY = 0\r\n\r\n  // On the first click and hold, record the offset of the pointer in relation\r\n  // to the point of click inside the element.\r\n  handler.addEventListener(_isTouch ? 'touchstart' : 'mousedown', function (e) {\r\n    e.stopPropagation()\r\n    e.preventDefault()\r\n    if (target.dataset.dragEnabled === 'false') {\r\n      return\r\n    }\r\n\r\n    let c = e\r\n    if (e.touches) {\r\n      c = e.touches[0]\r\n    }\r\n\r\n    isMoving = true\r\n    startX = target.offsetLeft - c.clientX\r\n    startY = target.offsetTop - c.clientY\r\n  })\r\n\r\n  // On leaving click, stop moving.\r\n  document.addEventListener(_isTouch ? 'touchend' : 'mouseup', function () {\r\n    if (onEnd && hasStarted) {\r\n      onEnd(target, parent, parseInt(target.style.left), parseInt(target.style.top))\r\n    }\r\n\r\n    isMoving = false\r\n    hasStarted = false\r\n  })\r\n\r\n  // On leaving click, stop moving.\r\n  document.addEventListener(_isTouch ? 'touchmove' : 'mousemove', function () {\r\n    if (onDrag && hasStarted) {\r\n      onDrag(target, parseInt(target.style.left), parseInt(target.style.top))\r\n    }\r\n  })\r\n\r\n  // Register mouse-move callback to move the element.\r\n  _callbacks.push(function move (x, y) {\r\n    if (!isMoving) {\r\n      return\r\n    }\r\n\r\n    if (!hasStarted) {\r\n      hasStarted = true\r\n      if (onStart) {\r\n        onStart(target, lastX, lastY)\r\n      }\r\n    }\r\n\r\n    lastX = x + startX\r\n    lastY = y + startY\r\n\r\n    // If boundary checking is on, don't let the element cross the viewport.\r\n    if (target.dataset.dragBoundary === 'true') {\r\n      if (lastX < 1 || lastX >= window.innerWidth - target.offsetWidth) {\r\n        return\r\n      }\r\n      if (lastY < 1 || lastY >= window.innerHeight - target.offsetHeight) {\r\n        return\r\n      }\r\n    }\r\n\r\n    target.style.left = lastX + 'px'\r\n    target.style.top = lastY + 'px'\r\n  })\r\n}\r\n\r\nexport { dragmove as default }\r\n","/**\r\n * @file ext-overview_window.js\r\n *\r\n * @license MIT\r\n *\r\n * @copyright 2013 James Sacksteder\r\n *\r\n */\r\nimport { dragmove } from './dragmove/dragmove.js'\r\n\r\nexport default {\r\n  name: 'overview_window',\r\n  init ({ _$ }) {\r\n    const svgEditor = this\r\n    const { $id, $click } = svgEditor.svgCanvas\r\n    const overviewWindowGlobals = {}\r\n\r\n    // Define and insert the base html element.\r\n    const propsWindowHtml =\r\n      '<div id=\"overview_window_content_pane\" style=\"width:100%; word-wrap:break-word;  display:inline-block; margin-top:20px;\">' +\r\n        '<div id=\"overview_window_content\" style=\"position:relative; padding-left:15px; top:0px;\">' +\r\n          '<div style=\"background-color:#A0A0A0; display:inline-block; overflow:visible;\">' +\r\n            '<svg id=\"overviewMiniView\" width=\"132\" height=\"100\" x=\"0\" y=\"0\" viewBox=\"0 0 4800 3600\" ' +\r\n                'xmlns=\"http://www.w3.org/2000/svg\" ' +\r\n                'xmlns:xlink=\"http://www.w3.org/1999/xlink\">' +\r\n              '<use x=\"0\" y=\"0\" xlink:href=\"#svgroot\"> </use>' +\r\n            '</svg>' +\r\n            '<div id=\"overview_window_view_box\" style=\"min-width:50px; min-height:50px; position:absolute; top:30px; left:30px; z-index:5; background-color:rgba(255,0,102,0.3);\">' +\r\n            '</div>' +\r\n          '</div>' +\r\n        '</div>' +\r\n      '</div>'\r\n    $id('sidepanel_content').insertAdjacentHTML('beforeend', propsWindowHtml)\r\n\r\n    // Define dynamic animation of the view box.\r\n    const updateViewBox = () => {\r\n      const { workarea } = svgEditor\r\n      const portHeight = parseFloat(getComputedStyle(workarea, null).height.replace('px', ''))\r\n      const portWidth = parseFloat(getComputedStyle(workarea, null).width.replace('px', ''))\r\n      const portX = workarea.scrollLeft\r\n      const portY = workarea.scrollTop\r\n      const windowWidth = parseFloat(getComputedStyle($id('svgcanvas'), null).width.replace('px', ''))\r\n      const windowHeight = parseFloat(getComputedStyle($id('svgcanvas'), null).height.replace('px', ''))\r\n      const overviewWidth = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\r\n      const overviewHeight = parseFloat(getComputedStyle($id('overviewMiniView'), null).height.replace('px', ''))\r\n\r\n      const viewBoxX = portX / windowWidth * overviewWidth\r\n      const viewBoxY = portY / windowHeight * overviewHeight\r\n      const viewBoxWidth = portWidth / windowWidth * overviewWidth\r\n      const viewBoxHeight = portHeight / windowHeight * overviewHeight\r\n\r\n      $id('overview_window_view_box').style.minWidth = viewBoxWidth + 'px'\r\n      $id('overview_window_view_box').style.minHeight = viewBoxHeight + 'px'\r\n      $id('overview_window_view_box').style.top = viewBoxY + 'px'\r\n      $id('overview_window_view_box').style.left = viewBoxX + 'px'\r\n    }\r\n    $id('workarea').addEventListener('scroll', () => {\r\n      if (!(overviewWindowGlobals.viewBoxDragging)) {\r\n        updateViewBox()\r\n      }\r\n    })\r\n    $id('workarea').addEventListener('resize', updateViewBox)\r\n    updateViewBox()\r\n\r\n    // Compensate for changes in zoom and canvas size.\r\n    const updateViewDimensions = function () {\r\n      const viewWidth = parseFloat(getComputedStyle($id('svgroot'), null).width.replace('px', ''))\r\n      const viewHeight = parseFloat(getComputedStyle($id('svgroot'), null).height.replace('px', ''))\r\n\r\n      const viewX = 640\r\n      const viewY = 480\r\n\r\n      const svgWidthOld = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\r\n      const svgHeightNew = viewHeight / viewWidth * svgWidthOld\r\n      $id('overviewMiniView').setAttribute('viewBox', viewX + ' ' + viewY + ' ' + viewWidth + ' ' + viewHeight)\r\n      $id('overviewMiniView').setAttribute('height', svgHeightNew)\r\n      updateViewBox()\r\n    }\r\n    updateViewDimensions()\r\n\r\n    // Set up the overview window as a controller for the view port.\r\n    overviewWindowGlobals.viewBoxDragging = false\r\n    const updateViewPortFromViewBox = function () {\r\n      const windowWidth = parseFloat(getComputedStyle($id('svgcanvas'), null).width.replace('px', ''))\r\n      const windowHeight = parseFloat(getComputedStyle($id('svgcanvas'), null).height.replace('px', ''))\r\n      const overviewWidth = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\r\n      const overviewHeight = parseFloat(getComputedStyle($id('overviewMiniView'), null).height.replace('px', ''))\r\n      const viewBoxX = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('left').replace('px', ''))\r\n      const viewBoxY = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('top').replace('px', ''))\r\n\r\n      const portX = viewBoxX / overviewWidth * windowWidth\r\n      const portY = viewBoxY / overviewHeight * windowHeight\r\n      $id('workarea').scrollLeft = portX\r\n      $id('workarea').scrollTop = portY\r\n    }\r\n    const onStart = () => {\r\n      overviewWindowGlobals.viewBoxDragging = true\r\n      updateViewPortFromViewBox()\r\n    }\r\n    const onEnd = (el, parent, _x, _y) => {\r\n      if ((el.offsetLeft + el.offsetWidth) > parseFloat(getComputedStyle(parent, null).width.replace('px', ''))) {\r\n        el.style.left = (parseFloat(getComputedStyle(parent, null).width.replace('px', '')) - el.offsetWidth) + 'px'\r\n      } else if (el.offsetLeft < 0) {\r\n        el.style.left = '0px'\r\n      }\r\n      if ((el.offsetTop + el.offsetHeight) > parseFloat(getComputedStyle(parent, null).height.replace('px', ''))) {\r\n        el.style.top = (parseFloat(getComputedStyle(parent, null).height.replace('px', '')) - el.offsetHeight) + 'px'\r\n      } else if (el.offsetTop < 0) {\r\n        el.style.top = '0px'\r\n      }\r\n      overviewWindowGlobals.viewBoxDragging = false\r\n      updateViewPortFromViewBox()\r\n    }\r\n    const onDrag = function () {\r\n      updateViewPortFromViewBox()\r\n    }\r\n    const dragElem = document.querySelector('#overview_window_view_box')\r\n    const parentElem = document.querySelector('#overviewMiniView')\r\n    dragmove(dragElem, dragElem, parentElem, onStart, onEnd, onDrag)\r\n\r\n    $click($id('overviewMiniView'), (evt) => {\r\n      // Firefox doesn't support evt.offsetX and evt.offsetY.\r\n      const mouseX = (evt.offsetX || evt.originalEvent.layerX)\r\n      const mouseY = (evt.offsetY || evt.originalEvent.layerY)\r\n      const overviewWidth = parseFloat(getComputedStyle($id('overviewMiniView'), null).width.replace('px', ''))\r\n      const overviewHeight = parseFloat(getComputedStyle($id('overviewMiniView'), null).height.replace('px', ''))\r\n      const viewBoxWidth = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('min-width').replace('px', ''))\r\n      const viewBoxHeight = parseFloat(getComputedStyle($id('overview_window_view_box'), null).getPropertyValue('min-height').replace('px', ''))\r\n\r\n      let viewBoxX = mouseX - 0.5 * viewBoxWidth\r\n      let viewBoxY = mouseY - 0.5 * viewBoxHeight\r\n      // deal with constraints\r\n      if (viewBoxX < 0) {\r\n        viewBoxX = 0\r\n      }\r\n      if (viewBoxY < 0) {\r\n        viewBoxY = 0\r\n      }\r\n      if (viewBoxX + viewBoxWidth > overviewWidth) {\r\n        viewBoxX = overviewWidth - viewBoxWidth\r\n      }\r\n      if (viewBoxY + viewBoxHeight > overviewHeight) {\r\n        viewBoxY = overviewHeight - viewBoxHeight\r\n      }\r\n      $id('overview_window_view_box').style.top = viewBoxY + 'px'\r\n      $id('overview_window_view_box').style.left = viewBoxX + 'px'\r\n      updateViewPortFromViewBox()\r\n    })\r\n\r\n    return {\r\n      name: 'overview window',\r\n      canvasUpdated: updateViewDimensions,\r\n      workareaResized: updateViewBox\r\n    }\r\n  }\r\n}\r\n"],"names":["_loaded","_callbacks","_isTouch","undefined","window","ontouchstart","name","init","svgEditor","this","$id","$click","svgCanvas","overviewWindowGlobals","insertAdjacentHTML","updateViewBox","workarea","portHeight","parseFloat","getComputedStyle","height","replace","portWidth","width","portX","scrollLeft","portY","scrollTop","windowWidth","windowHeight","overviewWidth","overviewHeight","viewBoxX","viewBoxY","viewBoxWidth","viewBoxHeight","style","minWidth","minHeight","top","left","addEventListener","viewBoxDragging","updateViewDimensions","viewWidth","viewHeight","svgHeightNew","setAttribute","viewX","updateViewPortFromViewBox","getPropertyValue","dragElem","document","querySelector","target","handler","parent","onStart","onEnd","onDrag","e","c","touches","i","length","clientX","clientY","isMoving","hasStarted","startX","startY","lastX","lastY","stopPropagation","preventDefault","dataset","dragEnabled","offsetLeft","offsetTop","parseInt","push","move","x","y","dragBoundary","innerWidth","offsetWidth","innerHeight","offsetHeight","dragmove","el","_x","_y","evt","mouseX","offsetX","originalEvent","layerX","mouseY","offsetY","layerY","canvasUpdated","workareaResized"],"mappings":"AAKA,IAAIA,GAAU,EACd,MAAMC,EAAa,GACbC,OAAmCC,IAAxBC,OAAOC;;;;;;;;;ACGxB,MAAe,CACbC,KAAM,kBACNC,cACQC,EAAYC,MACZC,IAAEA,EAAFC,OAAOA,GAAWH,EAAUI,UAC5BC,EAAwB,GAiB9BH,EAAI,qBAAqBI,mBAAmB,YAb1C,ksBAgBIC,cAAgB,WACdC,SAAEA,GAAaR,EACfS,EAAaC,WAAWC,iBAAiBH,EAAU,MAAMI,OAAOC,QAAQ,KAAM,KAC9EC,EAAYJ,WAAWC,iBAAiBH,EAAU,MAAMO,MAAMF,QAAQ,KAAM,KAC5EG,EAAQR,EAASS,WACjBC,EAAQV,EAASW,UACjBC,EAAcV,WAAWC,iBAAiBT,EAAI,aAAc,MAAMa,MAAMF,QAAQ,KAAM,KACtFQ,EAAeX,WAAWC,iBAAiBT,EAAI,aAAc,MAAMU,OAAOC,QAAQ,KAAM,KACxFS,EAAgBZ,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMa,MAAMF,QAAQ,KAAM,KAC/FU,EAAiBb,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMU,OAAOC,QAAQ,KAAM,KAEjGW,EAAWR,EAAQI,EAAcE,EACjCG,EAAWP,EAAQG,EAAeE,EAClCG,EAAeZ,EAAYM,EAAcE,EACzCK,EAAgBlB,EAAaY,EAAeE,EAElDrB,EAAI,4BAA4B0B,MAAMC,SAAWH,EAAe,KAChExB,EAAI,4BAA4B0B,MAAME,UAAYH,EAAgB,KAClEzB,EAAI,4BAA4B0B,MAAMG,IAAMN,EAAW,KACvDvB,EAAI,4BAA4B0B,MAAMI,KAAOR,EAAW,MAE1DtB,EAAI,YAAY+B,iBAAiB,UAAU,KACnC5B,EAAsB6B,iBAC1B3B,mBAGJL,EAAI,YAAY+B,iBAAiB,SAAU1B,eAC3CA,sBAGM4B,qBAAuB,iBACrBC,EAAY1B,WAAWC,iBAAiBT,EAAI,WAAY,MAAMa,MAAMF,QAAQ,KAAM,KAClFwB,EAAa3B,WAAWC,iBAAiBT,EAAI,WAAY,MAAMU,OAAOC,QAAQ,KAAM,KAMpFyB,EAAeD,EAAaD,EADd1B,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMa,MAAMF,QAAQ,KAAM,KAEnGX,EAAI,oBAAoBqC,aAAa,UAAWC,WAA4BJ,EAAY,IAAMC,GAC9FnC,EAAI,oBAAoBqC,aAAa,SAAUD,GAC/C/B,iBAEF4B,uBAGA9B,EAAsB6B,iBAAkB,QAClCO,0BAA4B,iBAC1BrB,EAAcV,WAAWC,iBAAiBT,EAAI,aAAc,MAAMa,MAAMF,QAAQ,KAAM,KACtFQ,EAAeX,WAAWC,iBAAiBT,EAAI,aAAc,MAAMU,OAAOC,QAAQ,KAAM,KACxFS,EAAgBZ,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMa,MAAMF,QAAQ,KAAM,KAC/FU,EAAiBb,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMU,OAAOC,QAAQ,KAAM,KAIjGG,EAHWN,WAAWC,iBAAiBT,EAAI,4BAA6B,MAAMwC,iBAAiB,QAAQ7B,QAAQ,KAAM,KAGlGS,EAAgBF,EACnCF,EAHWR,WAAWC,iBAAiBT,EAAI,4BAA6B,MAAMwC,iBAAiB,OAAO7B,QAAQ,KAAM,KAGjGU,EAAiBF,EAC1CnB,EAAI,YAAYe,WAAaD,EAC7Bd,EAAI,YAAYiB,UAAYD,GAuBxByB,EAAWC,SAASC,cAAc,oCD3GpB,SAAUC,EAAQC,EAASC,EAAQC,EAASC,EAAOC,GAEpE3D,GACHoD,SAASX,iBAAiBvC,EAAW,YAAc,aAAa,SAAU0D,OACpEC,EAAID,EACJA,EAAEE,UACJD,EAAID,EAAEE,QAAQ,QAIX,IAAIC,EAAI,EAAGA,EAAI9D,EAAW+D,OAAQD,IACrC9D,EAAW8D,GAAGF,EAAEI,QAASJ,EAAEK,YAKjClE,GAAU,MACNmE,GAAW,EAAWC,GAAa,EACnCC,EAAS,EAAOC,EAAS,EAAOC,EAAQ,EAAOC,EAAQ,EAI3DjB,EAAQd,iBAAiBvC,EAAW,aAAe,aAAa,SAAU0D,MACxEA,EAAEa,kBACFb,EAAEc,iBACiC,UAA/BpB,EAAOqB,QAAQC,uBAIff,EAAID,EACJA,EAAEE,UACJD,EAAID,EAAEE,QAAQ,IAGhBK,GAAW,EACXE,EAASf,EAAOuB,WAAahB,EAAEI,QAC/BK,EAAShB,EAAOwB,UAAYjB,EAAEK,WAIhCd,SAASX,iBAAiBvC,EAAW,WAAa,WAAW,WACvDwD,GAASU,GACXV,EAAMJ,EAAQE,EAAQuB,SAASzB,EAAOlB,MAAMI,MAAOuC,SAASzB,EAAOlB,MAAMG,MAG3E4B,GAAW,EACXC,GAAa,KAIfhB,SAASX,iBAAiBvC,EAAW,YAAc,aAAa,WAC1DyD,GAAUS,GACZT,EAAOL,EAAQyB,SAASzB,EAAOlB,MAAMI,MAAOuC,SAASzB,EAAOlB,MAAMG,SAKtEtC,EAAW+E,MAAK,SAASC,KAAMC,EAAGC,MAC3BhB,MAIAC,IACHA,GAAa,EACTX,GACFA,EAAQH,EAAQiB,EAAOC,IAI3BD,EAAQW,EAAIb,EACZG,EAAQW,EAAIb,EAGwB,SAAhChB,EAAOqB,QAAQS,aAAyB,IACtCb,EAAQ,GAAKA,GAASnE,OAAOiF,WAAa/B,EAAOgC,sBAGjDd,EAAQ,GAAKA,GAASpE,OAAOmF,YAAcjC,EAAOkC,oBAKxDlC,EAAOlB,MAAMI,KAAO+B,EAAQ,KAC5BjB,EAAOlB,MAAMG,IAAMiC,EAAQ,SC0B3BiB,CAAStC,EAAUA,EADAC,SAASC,cAAc,sBAtB1B,KACdxC,EAAsB6B,iBAAkB,EACxCO,+BAEY,CAACyC,EAAIlC,EAAQmC,EAAIC,KACxBF,EAAGb,WAAaa,EAAGJ,YAAepE,WAAWC,iBAAiBqC,EAAQ,MAAMjC,MAAMF,QAAQ,KAAM,KACnGqE,EAAGtD,MAAMI,KAAQtB,WAAWC,iBAAiBqC,EAAQ,MAAMjC,MAAMF,QAAQ,KAAM,KAAOqE,EAAGJ,YAAe,KAC/FI,EAAGb,WAAa,IACzBa,EAAGtD,MAAMI,KAAO,OAEbkD,EAAGZ,UAAYY,EAAGF,aAAgBtE,WAAWC,iBAAiBqC,EAAQ,MAAMpC,OAAOC,QAAQ,KAAM,KACpGqE,EAAGtD,MAAMG,IAAOrB,WAAWC,iBAAiBqC,EAAQ,MAAMpC,OAAOC,QAAQ,KAAM,KAAOqE,EAAGF,aAAgB,KAChGE,EAAGZ,UAAY,IACxBY,EAAGtD,MAAMG,IAAM,OAEjB1B,EAAsB6B,iBAAkB,EACxCO,+BAEa,WACbA,+BAMFtC,EAAOD,EAAI,qBAAsBmF,UAEzBC,EAAUD,EAAIE,SAAWF,EAAIG,cAAcC,OAC3CC,EAAUL,EAAIM,SAAWN,EAAIG,cAAcI,OAC3CtE,EAAgBZ,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMa,MAAMF,QAAQ,KAAM,KAC/FU,EAAiBb,WAAWC,iBAAiBT,EAAI,oBAAqB,MAAMU,OAAOC,QAAQ,KAAM,KACjGa,EAAehB,WAAWC,iBAAiBT,EAAI,4BAA6B,MAAMwC,iBAAiB,aAAa7B,QAAQ,KAAM,KAC9Hc,EAAgBjB,WAAWC,iBAAiBT,EAAI,4BAA6B,MAAMwC,iBAAiB,cAAc7B,QAAQ,KAAM,SAElIW,EAAW8D,EAAS,GAAM5D,EAC1BD,EAAWiE,EAAS,GAAM/D,EAE1BH,EAAW,IACbA,EAAW,GAETC,EAAW,IACbA,EAAW,GAETD,EAAWE,EAAeJ,IAC5BE,EAAWF,EAAgBI,GAEzBD,EAAWE,EAAgBJ,IAC7BE,EAAWF,EAAiBI,GAE9BzB,EAAI,4BAA4B0B,MAAMG,IAAMN,EAAW,KACvDvB,EAAI,4BAA4B0B,MAAMI,KAAOR,EAAW,KACxDiB,+BAGK,CACL3C,KAAM,kBACN+F,cAAe1D,qBACf2D,gBAAiBvF"}