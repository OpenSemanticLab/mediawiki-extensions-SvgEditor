{"version":3,"file":"ext-shapes.js","sources":["../../../../src/editor/extensions/ext-shapes/ext-shapes.js","../../../../src/editor/extensions/ext-shapes/locale/en.js","../../../../src/editor/extensions/ext-shapes/locale/fr.js","../../../../src/editor/extensions/ext-shapes/locale/zh-CN.js"],"sourcesContent":["/**\r\n * @file ext-shapes.js\r\n *\r\n * @license MIT\r\n *\r\n * @copyright 2010 Christian Tzurcanu, 2010 Alexis Deveria\r\n *\r\n */\r\nconst name = 'shapes'\r\n\r\nconst loadExtensionTranslation = async function (svgEditor) {\r\n  let translationModule\r\n  const lang = svgEditor.configObj.pref('lang')\r\n  try {\r\n    translationModule = await import(`./locale/${lang}.js`)\r\n  } catch (_error) {\r\n    console.warn(`Missing translation (${lang}) for ${name} - using 'en'`)\r\n    translationModule = await import('./locale/en.js')\r\n  }\r\n  svgEditor.i18next.addResourceBundle(lang, name, translationModule.default)\r\n}\r\n\r\nexport default {\r\n  name,\r\n  async init () {\r\n    const svgEditor = this\r\n    const canv = svgEditor.svgCanvas\r\n    const { $id, $click } = canv\r\n    const svgroot = canv.getSvgRoot()\r\n    let lastBBox = {}\r\n    await loadExtensionTranslation(svgEditor)\r\n\r\n    const modeId = 'shapelib'\r\n    const startClientPos = {}\r\n\r\n    let curShape\r\n    let startX\r\n    let startY\r\n\r\n    return {\r\n      callback () {\r\n        if ($id('tool_shapelib') === null) {\r\n          const buttonTemplate = `\r\n          <se-explorerbutton id=\"tool_shapelib\" title=\"${svgEditor.i18next.t(`${name}:buttons.0.title`)}\" lib=\"./extensions/ext-shapes/shapelib/\"\r\n          src=\"shapelib.svg\"></se-explorerbutton>\r\n          `\r\n          canv.insertChildAtIndex($id('tools_left'), buttonTemplate, 9)\r\n          $click($id('tool_shapelib'), () => {\r\n            if (this.leftPanel.updateLeftPanel('tool_shapelib')) {\r\n              canv.setMode(modeId)\r\n            }\r\n          })\r\n        }\r\n      },\r\n      mouseDown (opts) {\r\n        const mode = canv.getMode()\r\n        if (mode !== modeId) { return undefined }\r\n\r\n        const currentD = document.getElementById('tool_shapelib').dataset.draw\r\n        startX = opts.start_x\r\n        const x = startX\r\n        startY = opts.start_y\r\n        const y = startY\r\n        const curStyle = canv.getStyle()\r\n\r\n        startClientPos.x = opts.event.clientX\r\n        startClientPos.y = opts.event.clientY\r\n\r\n        curShape = canv.addSVGElementsFromJson({\r\n          element: 'path',\r\n          curStyles: true,\r\n          attr: {\r\n            d: currentD,\r\n            id: canv.getNextId(),\r\n            opacity: curStyle.opacity / 2,\r\n            style: 'pointer-events:none'\r\n          }\r\n        })\r\n\r\n        curShape.setAttribute('transform', 'translate(' + x + ',' + y + ') scale(0.005) translate(' + -x + ',' + -y + ')')\r\n\r\n        canv.recalculateDimensions(curShape)\r\n\r\n        lastBBox = curShape.getBBox()\r\n\r\n        return {\r\n          started: true\r\n        }\r\n      },\r\n      mouseMove (opts) {\r\n        const mode = canv.getMode()\r\n        if (mode !== modeId) { return }\r\n\r\n        const zoom = canv.getZoom()\r\n        const evt = opts.event\r\n\r\n        const x = opts.mouse_x / zoom\r\n        const y = opts.mouse_y / zoom\r\n\r\n        const tlist = curShape.transform.baseVal\r\n        const box = curShape.getBBox()\r\n        const left = box.x; const top = box.y\r\n\r\n        const newbox = {\r\n          x: Math.min(startX, x),\r\n          y: Math.min(startY, y),\r\n          width: Math.abs(x - startX),\r\n          height: Math.abs(y - startY)\r\n        }\r\n\r\n        let sx = (newbox.width / lastBBox.width) || 1\r\n        let sy = (newbox.height / lastBBox.height) || 1\r\n\r\n        // Not perfect, but mostly works...\r\n        let tx = 0\r\n        if (x < startX) {\r\n          tx = lastBBox.width\r\n        }\r\n        let ty = 0\r\n        if (y < startY) {\r\n          ty = lastBBox.height\r\n        }\r\n\r\n        // update the transform list with translate,scale,translate\r\n        const translateOrigin = svgroot.createSVGTransform()\r\n        const scale = svgroot.createSVGTransform()\r\n        const translateBack = svgroot.createSVGTransform()\r\n\r\n        translateOrigin.setTranslate(-(left + tx), -(top + ty))\r\n        if (!evt.shiftKey) {\r\n          const max = Math.min(Math.abs(sx), Math.abs(sy))\r\n\r\n          sx = max * (sx < 0 ? -1 : 1)\r\n          sy = max * (sy < 0 ? -1 : 1)\r\n        }\r\n        scale.setScale(sx, sy)\r\n\r\n        translateBack.setTranslate(left + tx, top + ty)\r\n        tlist.appendItem(translateBack)\r\n        tlist.appendItem(scale)\r\n        tlist.appendItem(translateOrigin)\r\n\r\n        canv.recalculateDimensions(curShape)\r\n\r\n        lastBBox = curShape.getBBox()\r\n      },\r\n      mouseUp (opts) {\r\n        const mode = canv.getMode()\r\n        if (mode !== modeId) { return undefined }\r\n\r\n        const keepObject = (opts.event.clientX !== startClientPos.x && opts.event.clientY !== startClientPos.y)\r\n\r\n        return {\r\n          keep: keepObject,\r\n          element: curShape,\r\n          started: false\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","export default {\r\n  loading: 'Loading...',\r\n  categories: {\r\n    basic: 'Basic',\r\n    object: 'Objects',\r\n    symbol: 'Symbols',\r\n    arrow: 'Arrows',\r\n    flowchart: 'Flowchart',\r\n    animal: 'Animals',\r\n    game: 'Cards & Chess',\r\n    dialog_balloon: 'Dialog balloons',\r\n    electronics: 'Electronics',\r\n    math: 'Mathematical',\r\n    music: 'Music',\r\n    misc: 'Miscellaneous',\r\n    raphael_1: 'raphaeljs.com set 1',\r\n    raphael_2: 'raphaeljs.com set 2'\r\n  },\r\n  buttons: [\r\n    {\r\n      title: 'Shape library'\r\n    }\r\n  ]\r\n}\r\n","export default {\r\n  loading: 'Chargement...',\r\n  categories: {\r\n    basic: 'Basique',\r\n    object: 'Objets',\r\n    symbol: 'Symboles',\r\n    arrow: 'Flèches',\r\n    flowchart: 'Flowchart',\r\n    animal: 'Animaux',\r\n    game: 'Cartes & Echecs',\r\n    dialog_balloon: 'Dialog balloons',\r\n    electronics: 'Electronique',\r\n    math: 'Mathematiques',\r\n    music: 'Musique',\r\n    misc: 'Divers',\r\n    raphael_1: 'raphaeljs.com set 1',\r\n    raphael_2: 'raphaeljs.com set 2'\r\n  },\r\n  buttons: [\r\n    {\r\n      title: \"Bibliothèque d'images\"\r\n    }\r\n  ]\r\n}\r\n","export default {\r\n  loading: '正在加载...',\r\n  categories: {\r\n    basic: '基本',\r\n    object: '对象',\r\n    symbol: '符号',\r\n    arrow: '箭头',\r\n    flowchart: '工作流',\r\n    animal: '动物',\r\n    game: '棋牌',\r\n    dialog_balloon: '会话框',\r\n    electronics: '电子',\r\n    math: '数学',\r\n    music: '音乐',\r\n    misc: '其他',\r\n    raphael_1: 'raphaeljs.com 集合 1',\r\n    raphael_2: 'raphaeljs.com 集合 2'\r\n  },\r\n  buttons: [\r\n    {\r\n      title: '图元库'\r\n    }\r\n  ]\r\n}\r\n"],"names":["name","loadExtensionTranslation","async","svgEditor","translationModule","lang","configObj","pref","__variableDynamicImportRuntime0__","_error","console","warn","Promise","i18next","addResourceBundle","default","this","canv","svgCanvas","$id","$click","svgroot","getSvgRoot","lastBBox","modeId","startClientPos","curShape","startX","startY","callback","buttonTemplate","t","insertChildAtIndex","leftPanel","updateLeftPanel","setMode","mouseDown","opts","getMode","currentD","document","getElementById","dataset","draw","start_x","x","start_y","y","curStyle","getStyle","event","clientX","clientY","addSVGElementsFromJson","element","curStyles","attr","d","id","getNextId","opacity","style","setAttribute","recalculateDimensions","getBBox","started","mouseMove","zoom","getZoom","evt","mouse_x","mouse_y","tlist","transform","baseVal","box","left","top","newbox","Math","min","abs","sx","width","sy","height","tx","ty","translateOrigin","createSVGTransform","scale","translateBack","setTranslate","shiftKey","max","setScale","appendItem","mouseUp","keep","loading","categories","basic","object","symbol","arrow","flowchart","animal","game","dialog_balloon","electronics","math","music","misc","raphael_1","raphael_2","buttons","title"],"mappings":"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"}